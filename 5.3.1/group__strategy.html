<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.9.5" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EleFits: File-level strategies</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top">
      <!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr style="height: 56px;">
              <td id="projectlogo"><a href="https://cnes.github.io/EleFits/"><img alt="Logo"
                    src="elefits_notext.png" /></a></td>
              <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">EleFits
                  <span id="projectnumber">&#160;5.3.1</span>
                </div>
                <div id="projectbrief">A modern C++ API on top of CFITSIO</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
      <!-- GitHub corner -->
      <a href="https://github.com/CNES/EleFits" class="github-corner" aria-label="View source on GitHub"><svg
          viewBox="0 0 250 250" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path
            d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
            fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path
            d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
            fill="currentColor" class="octo-body"></path>
        </svg></a>
      <!-- GitHub corner --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle"><div class="title">File-level strategies<div class="ingroups"><a class="el" href="group__handlers.html">File and HDU handlers</a></div></div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Register actions to be performed automatically according to some criteria. </p>
<h1><a class="anchor" id="strategy-intro"></a>
Action!</h1>
<p >Often, when reading or writing MEF files, the same actions have to be performed for all or some of the HDUs. For example, each time an HDU is accessed for the first time, the checksums can be validated. And before closing the file, the checksums of the edited HDUs can be updated if present.</p>
<p >Instead of doing so manually, e.g.:</p>
<div class="fragment"><div class="line">MefFile f(filename, <a class="code hl_enumvalue" href="namespaceEuclid_1_1Fits_a031770da453a180e21dcbef5cf5aeab6.html#a031770da453a180e21dcbef5cf5aeab6a7dce122004969d56ae2e0245cb754d35">FileMode::Edit</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span>&amp; p = f.primary();</div>
<div class="line">p.verify_checksums();</div>
<div class="line">... <span class="comment">// Do something with Primary</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; image : f.filter&lt;ImageRaster&gt;()) {</div>
<div class="line">  ... <span class="comment">// Do something with extension</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; h : f.filter&lt;Header&gt;(<a class="code hl_variable" href="classEuclid_1_1Fits_1_1HduCategory.html#ae4b83ad1811ff1e735f0d0b54fdfff30">HduCategory::Edited</a>)) {</div>
<div class="line">  <span class="keywordflow">if</span> (h.has(<span class="stringliteral">&quot;CHECKSUM&quot;</span>) || h.has(<span class="stringliteral">&quot;DATASUM&quot;</span>)) {</div>
<div class="line">    h.update_checksums();</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aclassEuclid_1_1Fits_1_1HduCategory_html_ae4b83ad1811ff1e735f0d0b54fdfff30"><div class="ttname"><a href="classEuclid_1_1Fits_1_1HduCategory.html#ae4b83ad1811ff1e735f0d0b54fdfff30">Euclid::Fits::HduCategory::Edited</a></div><div class="ttdeci">static const HduCategory Edited</div><div class="ttdoc">Metadata or data was written.</div><div class="ttdef"><b>Definition:</b> HduCategory.h:254</div></div>
<div class="ttc" id="anamespaceEuclid_1_1Fits_a031770da453a180e21dcbef5cf5aeab6_html_a031770da453a180e21dcbef5cf5aeab6a7dce122004969d56ae2e0245cb754d35"><div class="ttname"><a href="namespaceEuclid_1_1Fits_a031770da453a180e21dcbef5cf5aeab6.html#a031770da453a180e21dcbef5cf5aeab6a7dce122004969d56ae2e0245cb754d35">Euclid::Fits::FileMode::Edit</a></div><div class="ttdeci">@ Edit</div><div class="ttdoc">Open an existing file with write permission.</div></div>
</div><!-- fragment --><p >... <code><a class="el" href="classEuclid_1_1Fits_1_1Action.html" title="Base class for strategy actions.">Action</a></code>s can be registered in the <code><a class="el" href="classEuclid_1_1Fits_1_1MefFile.html" title="Multi-Extension FITS file reader-writer.">MefFile</a></code> and performed automatically:</p>
<div class="fragment"><div class="line">MefFile f(filename, <a class="code hl_enumvalue" href="namespaceEuclid_1_1Fits_a031770da453a180e21dcbef5cf5aeab6.html#a031770da453a180e21dcbef5cf5aeab6a7dce122004969d56ae2e0245cb754d35">FileMode::Edit</a>, VerifyChecksums());</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span>&amp; p = f.primary();</div>
<div class="line">... <span class="comment">// Do something with Primary</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; image : f.filter&lt;ImageRaster&gt;(<a class="code hl_variable" href="classEuclid_1_1Fits_1_1HduCategory.html#a464b53f4ec9cf4d2549774864a93dca4">HduCategory::Ext</a>)) {</div>
<div class="line">    ... <span class="comment">// Do something with extensions</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassEuclid_1_1Fits_1_1HduCategory_html_a464b53f4ec9cf4d2549774864a93dca4"><div class="ttname"><a href="classEuclid_1_1Fits_1_1HduCategory.html#a464b53f4ec9cf4d2549774864a93dca4">Euclid::Fits::HduCategory::Ext</a></div><div class="ttdeci">static const HduCategory Ext</div><div class="ttdoc">Extension.</div><div class="ttdef"><b>Definition:</b> HduCategory.h:230</div></div>
</div><!-- fragment --><p >This removes boilerplate and noise in the code, and guarantees nothing is forgotten. Moreover, HDUs are guaranteed to be visited only once whatever the action count.</p>
<h1><a class="anchor" id="strategy-interface"></a>
Interfaces</h1>
<p >Acions are classes which inherit <code><a class="el" href="classEuclid_1_1Fits_1_1Action.html" title="Base class for strategy actions.">Action</a></code> and override at least one of its methods, like <code>accessed()</code> or <code>closing()</code>. Each time an action-related event occurs (an HDU is accessed for the first time or the file is being closed), all of the registered actions which override the corresponding method are executed.</p>
<p >The list of actions registered in the <code><a class="el" href="classEuclid_1_1Fits_1_1MefFile.html" title="Multi-Extension FITS file reader-writer.">MefFile</a></code> constitutes the so-called strategy.</p>
<p >A specific part of the strategy relates to internal compression: it is possible to specify which compression algorithm to use when creating a new image HDU according to predefined criteria. For more details, refer to <a class="el" href="group__compression.html">Image compression</a>.</p>
<p >Actions (or complete strategies) can be registered at construction, like in the introductory example, or using <code><a class="el" href="classEuclid_1_1Fits_1_1MefFile.html#a830deb08821f0de0be111104e1b9dea7" title="Get the strategy.">MefFile::strategy()</a></code> methods and/or its <code><a class="el" href="classEuclid_1_1Fits_1_1Strategy.html" title="MEF file strategy.">Strategy</a></code> instance.</p>
<p >Predefined actions, provided with the library, are listed below. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga34ebef858a0f4d2cc880dde7691eea72"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__strategy_ga34ebef858a0f4d2cc880dde7691eea72.html#ga34ebef858a0f4d2cc880dde7691eea72">UpdateChecksums</a> { <br />
&#160;&#160;<a class="el" href="group__strategy_ga34ebef858a0f4d2cc880dde7691eea72.html#gga34ebef858a0f4d2cc880dde7691eea72a6adf97f83acf6453d4a6a4b1070f3754">None</a>
, <br />
&#160;&#160;<a class="el" href="group__strategy_ga34ebef858a0f4d2cc880dde7691eea72.html#gga34ebef858a0f4d2cc880dde7691eea72a6f64ae857ab55cba2c3941fbc59285d5">Outdated</a>
, <br />
&#160;&#160;<a class="el" href="group__strategy_ga34ebef858a0f4d2cc880dde7691eea72.html#gga34ebef858a0f4d2cc880dde7691eea72a9a4126acaceec359707f5c87ad623fb5">EditedHdu</a>
, <br />
&#160;&#160;<a class="el" href="group__strategy_ga34ebef858a0f4d2cc880dde7691eea72.html#gga34ebef858a0f4d2cc880dde7691eea72a3cd62096498815a59d53a7eaa708d814">AnyHdu</a>
<br />
 }</td></tr>
<tr class="memdesc:ga34ebef858a0f4d2cc880dde7691eea72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checksum update policy of <code>VerifyChecksums</code>.  <a href="group__strategy_ga34ebef858a0f4d2cc880dde7691eea72.html#ga34ebef858a0f4d2cc880dde7691eea72">More...</a><br /></td></tr>
<tr class="separator:ga34ebef858a0f4d2cc880dde7691eea72"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEuclid_1_1Fits_1_1Action.html">Action</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class for strategy actions.  <a href="classEuclid_1_1Fits_1_1Action.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEuclid_1_1Fits_1_1CiteEleFits.html">CiteEleFits</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An action which cites EleFits in the Primary header as a HISTORY record.  <a href="classEuclid_1_1Fits_1_1CiteEleFits.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEuclid_1_1Fits_1_1Strategy.html">Strategy</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">MEF file strategy.  <a href="classEuclid_1_1Fits_1_1Strategy.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEuclid_1_1Fits_1_1VerifyChecksums.html">VerifyChecksums</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An action which verifies and possibly updates existing checksums.  <a href="classEuclid_1_1Fits_1_1VerifyChecksums.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<hr class="footer" />
<address class="footer"><small>
    © Copyright 2019-2022 CNES and contributors (for the Euclid Science Ground Segment).
    <br>
    The EleFits documentation is licensed under a
    <a rel="license" href="md_LICENSE.html">LGPL-3.0-or-later</a> license.
    <br>
    It is generated by <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.9.5
    with a theme adapted from <a href="https://github.com/jothepro/doxygen-awesome-css">Doxygen Awesome</a>
    and using <a href="https://github.com/tholman/github-corners">GitHub Corners</a>.
    Thank you all!
  </small></address>
</body>
</html>