<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.9.5" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EleFits: On types</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top">
      <!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr style="height: 56px;">
              <td id="projectlogo"><a href="https://cnes.github.io/EleFits/"><img alt="Logo"
                    src="elefits_notext.png" /></a></td>
              <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">EleFits
                  <span id="projectnumber">&#160;5.3.0</span>
                </div>
                <div id="projectbrief">A modern C++ API on top of CFITSIO</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
      <!-- GitHub corner -->
      <a href="https://github.com/CNES/EleFits" class="github-corner" aria-label="View source on GitHub"><svg
          viewBox="0 0 250 250" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path
            d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
            fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path
            d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
            fill="currentColor" class="octo-body"></path>
        </svg></a>
      <!-- GitHub corner --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">On types<div class="ingroups"><a class="el" href="group__guidelines.html">Development guidelines</a></div></div></div>
</div><!--header-->
<div class="contents">
<p >Which types to use? </p>
<h1><a class="anchor" id="types-indices"></a>
Indices</h1>
<p >Indices in the <code><a class="el" href="namespaceEuclid_1_1Fits.html" title="Wrapper classes to read and write FITS file contents.">Fits</a></code> namespace are 0-based <code>long</code>s. Here is why.</p>
<p >There is no way to make everybody happy:</p>
<ul>
<li>FITS generally relies on 1-based integers, sign-ness of which is undefined;</li>
<li>HDUs have no index in the FITS definition: they are just contiguous in the file;</li>
<li>C uses 0-based signed integers;</li>
<li>The C++ standard library uses 0-based unsigned integers;</li>
<li>CFITSIO uses 1-based signed integers with varying type (e.g. <code>int</code> for column count and <code>long</code> or <code>LONGLONG</code> for row count).</li>
</ul>
<p >Following the <a href="https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Res-subscripts">C++ Core Guidelines</a>, we've opted for signed integers, and precisely for <code>long</code>'s. To reduce the noise, we did not create a custom type like "index", "length" or "size". We do not rely on <code>ptrdiff_t</code> as suggested in the Guidelines, because it would create issues when interfacing internally with CFITSIO. Using <code>long</code>s conveys the following message: trying to use something larger than the max of <code>long</code> won't work.</p>
<p >Having signed indices also enables backard indexing, where -1 means the last index. This is supported, for example, by the <code><a class="el" href="classEuclid_1_1Fits_1_1Raster_ac897e10b0d19af5bda847d60d5eba343.html#ac897e10b0d19af5bda847d60d5eba343" title="Access the pixel value at given position.">Raster::at()</a></code> and <code><a class="el" href="classEuclid_1_1Fits_1_1Column.html#a1e471b8ae7458589960e40ae9903156d" title="Access the value at given row and repeat indices.">Column::at()</a></code> methods.</p>
<p >Since indices in <code><a class="elRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></code>s are 0-based, and we use a lot of <code><a class="elRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></code>s, we follow the same convention to provide a fully consistent API. This way, the user code only copes with 0-based indices.</p>
<p >In general, sizes are also <code>long</code>s, with a notable exception for containers' <code>size()</code> method, for the sake of compatibility with the standard library, in particular the <code><a class="el" href="interfaceContiguousContainer.html" title="Standard contiguous container requirements.">ContiguousContainer</a></code> named requirements.</p>
<h1><a class="anchor" id="types-data"></a>
Data types</h1>
<p >As shown in the <a class="el" href="type_map.html">CFITSIO type mapping table</a>, handling data types right with CFITSIO can be very cumbersome. EleFits aims at carrying the boilerplate internally, so that the user doesn't need to know the underlying architecture or CFITSIO implementation. Template functions and methods are provided to simply let the user set the desired type, e.g.:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> raster = ext.raster().read&lt;<span class="keywordtype">float</span>&gt;();</div>
</div><!-- fragment --><p >When possible, conversions are performed internally when the template type does not correspond to the file type.</p>
<h2><a class="anchor" id="types-data-int"></a>
Integers</h2>
<p >Integer types are numerous. There are two main categories: fixed-size integers (e.g. <code><a class="elRef" href="http://en.cppreference.com/w/cpp/types/integer.html">std::int32_t</a></code>) and C integers (e.g. <code>int</code>). It is strongly recommended to use fixed-size integers to avoid bad surprises when changing the system. Indeed, if an image of pixel type <code>int</code> is written on a system where it is encoded as a 64-bit integers, and read on a system where it is encoded as a 32-bit integer, values will be corrupted. This is avoided by using <code><a class="elRef" href="http://en.cppreference.com/w/cpp/types/integer.html">std::int32_t</a></code> instead.</p>
<p >The FITS format doesn't natively support unsigned integers or signed bytes. Yet, CFITSIO and EleFits rely on the scaling mechanism to support them: an unsigned integer value will be internally offset to get a signed integer in the file. The offset is written in the file as a <code>BZERO</code> (image HDU) or <code>TZERO</code> (binary table HDU) keyword record, used to correctly recover the value at reading.</p>
<h2><a class="anchor" id="types-data-string"></a>
String</h2>
<p >Strings are represented as <code><a class="elRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></code> and not <code>const char*</code> in general. Yet, a few sevices are overloaded with <code>const char*</code> for convenience.</p>
<h2><a class="anchor" id="types-data-variant"></a>
VariantValue</h2>
<p >In addition to CFITSIO data types, EleFits provides some of the services for <code>VariantValue</code> (e.g., to read records). In this case, the underlying type is wrapped in a <code>VariantValue</code> object, which can be cast later.</p>
<p >Development efforts have been put to allow the user to get whatever compatible type from the <code>VariantValue</code> object. For example, assume some <code>unsigned long</code> record value is read as a <code>VariantValue</code>. The library will allow the user casting to <code>long long</code> because this is a mathematically valid conversion, where <code>std::any_cast&lt;long long&gt;()</code> and the likes would throw an exception. </p>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<hr class="footer" />
<address class="footer"><small>
    © Copyright 2019-2022 CNES and contributors (for the Euclid Science Ground Segment).
    <br>
    The EleFits documentation is licensed under a
    <a rel="license" href="md_LICENSE.html">LGPL-3.0-or-later</a> license.
    <br>
    It is generated by <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.9.5
    with a theme adapted from <a href="https://github.com/jothepro/doxygen-awesome-css">Doxygen Awesome</a>
    and using <a href="https://github.com/tholman/github-corners">GitHub Corners</a>.
    Thank you all!
  </small></address>
</body>
</html>