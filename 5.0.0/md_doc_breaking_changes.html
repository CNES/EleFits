<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.9.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EleFits: Breaking changes and migration guide</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top">
      <!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr style="height: 56px;">
              <td id="projectlogo"><a href="https://cnes.github.io/EleFits/"><img alt="Logo"
                    src="elefits_notext.png" /></a></td>
              <td id="projectalign" style="padding-left: 0.5em;">
                <div id="projectname">EleFits
                  <span id="projectnumber">&#160;5.0.0</span>
                </div>
                <div id="projectbrief">A modern C++ API on top of CFITSIO</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
      <!-- GitHub corner -->
      <a href="https://github.com/CNES/EleFits" class="github-corner" aria-label="View source on GitHub"><svg
          viewBox="0 0 250 250" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path
            d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
            fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path
            d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
            fill="currentColor" class="octo-body"></path>
        </svg></a>
      <!-- GitHub corner --><!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Breaking changes and migration guide </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md65">Purpose</a></li>
<li class="level1"><a href="#autotoc_md66">Breaking changes in 5.0</a><ul><li class="level2"><a href="#autotoc_md67">Introduction</a></li>
<li class="level2"><a href="#autotoc_md68">Many names are standardized</a></li>
<li class="level2"><a href="#autotoc_md69">Column entries have a shape instead of repeat count</a></li>
<li class="level2"><a href="#autotoc_md70">PtrRaster constructor change</a></li>
<li class="level2"><a href="#autotoc_md71">Raster and Column refactoring</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md72">Breaking changes in 4.0</a><ul><li class="level2"><a href="#autotoc_md73">Introduction</a></li>
<li class="level2"><a href="#autotoc_md74">EL_FitsIO becomes EleFits and associated changes</a></li>
<li class="level2"><a href="#autotoc_md75">3rd handler level</a></li>
<li class="level2"><a href="#autotoc_md76">RecordHdu becomes Hdu</a></li>
<li class="level2"><a href="#autotoc_md77">FitsFile::Permission becomes FileMode</a></li>
<li class="level2"><a href="#autotoc_md78">HduType becomes HduCategory</a></li>
<li class="level2"><a href="#autotoc_md79">MefFile::accessPrimary() becomes MefFile::primary() and is not a template anymore</a></li>
<li class="level2"><a href="#autotoc_md80">Raster::shape and Column::info become methods</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md81">Breaking changes in 3.0</a><ul><li class="level2"><a href="#autotoc_md82">All indices are 0-based</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md83">Breaking changes in 2.0</a><ul><li class="level2"><a href="#autotoc_md84">Method name change</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md65"></a>
Purpose</h1>
<p >For each major version, this page lists the breaking changes, details the underlying rationale, the status in the previous version (e.g. what's there already and what's deprecated), and how to adapt the client code.</p>
<h1><a class="anchor" id="autotoc_md66"></a>
Breaking changes in 5.0</h1>
<h2><a class="anchor" id="autotoc_md67"></a>
Introduction</h2>
<p >The brand new feature brought by version 5.0 is the support for multidimensional columns. This has a few impacts on the public API (e.g. the columns now have a dimension and shape), most of which are backward compatible (but not all of them).</p>
<p >In order to accomodate multidimensional columns, data classes (including <code>Raster</code>) were refactored. The refactoring brings a lot of improvements related to performance and flexibility. Yet, most changes in the API (including the additional template parameters, see below) won't even impact user codes.</p>
<h2><a class="anchor" id="autotoc_md68"></a>
Many names are standardized</h2>
<p >In <code>MefFile</code> (breaking):</p><ul>
<li><code>accessFirst()</code> -&gt; <code>find()</code></li>
<li><code>select()</code> -&gt; <code>filter()</code></li>
</ul>
<p >In containers, type aliases are introduced generally without breaking the API, e.g. <code>value_type</code> is added, but <code>Value</code> is kept (though as <code>std::decay_t&lt;value_type&gt;</code> instead of <code>value_type</code>).</p>
<p ><b>Rationale</b></p>
<p >Standard names are already understood by some users.</p>
<p ><b>Impact on client code</b></p>
<p >Update names (previous names are kept for backward compatibility in this version).</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Column entries have a shape instead of repeat count</h2>
<p >Variable <code>ColumnInfo::repeatCount</code> becomes method <code>ColumnInfo::repeatCount()</code>.</p>
<p ><b>Rationale</b></p>
<p >The repeat count is not sufficient to describe multidimensional entries, while having both a repeat count and shape would be unsafe.</p>
<p ><b>Impact on client code</b></p>
<p >No impact at construction.</p>
<p >To read the repeat count value, use <code>ColumnInfo::repeatCount()</code> instead of <code>ColumnInfo::repeatCount</code>.</p>
<p >To update the repeat count, use <code>Column::reshape()</code>.</p>
<h2><a class="anchor" id="autotoc_md70"></a>
PtrRaster constructor change</h2>
<p ><code>PtrColumn(info, elementCount, data)</code> becomes <code>PtrColumn(info, rowCount, data)</code>.</p>
<p ><b>Rationale</b></p>
<p >Implementation of the data classes was completely refactored for improved performance, more flexibility and easier maintenance (see below). This came with the merging of <code>PtrRaster</code> and <code>VecRaster</code> (which are now mere aliases) and therefore of their constructors.</p>
<p ><b>Impact on client code</b></p>
<p >Calls to the constructor should be updated.</p>
<h2><a class="anchor" id="autotoc_md71"></a>
Raster and Column refactoring</h2>
<p ><code>Raster&lt;T, N&gt;</code> has become <code>Raster&lt;T, N, TContainer&gt;</code>, where the added template parameter allows working with any contiguous container. <code>PtrRaster</code> and <code>VecRaster</code> are no more classes which inherit <code>Raster</code> but typedefs insead: <code>PtrRaster&lt;T, N&gt; = Raster&lt;T, N, T*&gt;</code> and <code>VecRaster&lt;T, N&gt; = Raster&lt;T, N, vector&lt;T&gt;&gt;</code>.</p>
<p ><code>PtrRaster</code> and <code>VecRaster</code> are backward compatible.</p>
<p ><code>Column&lt;T&gt;</code> has become <code>Column&lt;T, N, TContainer&gt;</code>, where the added template parameters allow supporting multidimensional entries and working with any contiguous container. <code>PtrColumn</code> and <code>VecColumn</code> are no more classes which inherit <code>Column</code> but typedefs insead: <code>PtrColumn&lt;T, N&gt; = Column&lt;T, N, T*&gt;</code> and <code>VecColumn&lt;T, N&gt; = Column&lt;T, N, vector&lt;T&gt;&gt;</code>.</p>
<p >The default value of <code>N</code> is 1 to limit impact on client code.</p>
<p >Let alone the change in <code>PtrColumn</code>'s constructor described above, <code>PtrColumn</code> and <code>VecColumn</code> are backward compatible.</p>
<p ><b>Impact on client code</b></p>
<p >None for basic usage.</p>
<p >For user-defined functions which used to return or take a <code>Raster</code> or a <code>Column</code> or a <code>ColumnInfo</code> as parameter, e.g. <code>void f(Column&lt;T&gt;&amp; column)</code>, there are several options:</p><ul>
<li>add the new template parameters, e.g. <code>void f(Column&lt;T, N, TContainer&gt;&amp; column)</code>;</li>
<li>fix the new template parameters, e.g. <code>void f(VecColumn&lt;T&gt;&amp; column)</code>;</li>
<li>use a template for the parameter itself, e.g. <code>void f(TColumn&amp; column)</code> (which is the path taken by EleFits).</li>
</ul>
<h1><a class="anchor" id="autotoc_md72"></a>
Breaking changes in 4.0</h1>
<h2><a class="anchor" id="autotoc_md73"></a>
Introduction</h2>
<p >Version 4.0 introduces many changes to the API. Most of them are already in place in version 3.2, but with backward compatibility ensured by aliases. This is done to make transition smoother on client code side. Therefore, in 3.2, the user can use both 3.x and 4.x versions of the API. Items removed from the API in 4.0 are marked deprecated in 3.2.</p>
<h2><a class="anchor" id="autotoc_md74"></a>
EL_FitsIO becomes EleFits and associated changes</h2>
<p >Namespace <code>FitsIO</code> becomes <code>Fits</code>. Prefix <code>EL_Fits</code> (resp. <code>EL_FITSIO</code>) becomes <code>EleFits</code> (resp. <code>ELEFITS</code>). <code>EL_FitsFile</code> becomes <code>EleFits</code>. Underscores in program names are removed.</p>
<p ><b>Rationale</b></p>
<ul>
<li>Underscores are forbidden by some package managers;</li>
<li>Easier to say, read and write;</li>
<li>"EL" stands for Euclid library, while the project is instead a package with libraries and executables; "Ele" stands for Euclid libraries and executables.</li>
</ul>
<p ><b>Status in version 3.2</b></p>
<p >Change not applied: compatibility with 4.0 cannot be anticipated in code which depends on 3.2.</p>
<p ><b>Impact on client code</b></p>
<ul>
<li>Find and replace word <code>EL_FitsIO</code> with <code>EleFits</code> in CMakeLists';</li>
<li>Find and replace prefix <code>EL_Fits</code> with <code>EleFits</code> in CMakeLists' and in includes;</li>
<li>Find and replace prefix <code>EL_FITSIO</code> with <code>ELEFITS</code> in macros;</li>
<li>Find and replace <code>FitsIO</code> (e.g. namespace <code>FitsIO</code> or class <code>FitsIOError</code>) with <code>Fits</code> in sources;</li>
<li>Remove underscores from program names in command lines.</li>
</ul>
<h2><a class="anchor" id="autotoc_md75"></a>
3rd handler level</h2>
<p >In addition to file- and HDU-level handlers, additional classes are defined at header or data level. For example, records are accessed through <code>MefFile</code>/<code>RecordHdu</code>/<code>Header</code> instead of <code>MefFile</code>/<code>RecordHdu</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// Until 4.0</span></div>
<div class="line">f.access&lt;&gt;(3).writeRecord(<span class="stringliteral">&quot;KEY&quot;</span>, 1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Since 4.0</span></div>
<div class="line">f.access&lt;&gt;(3).header().write(<span class="stringliteral">&quot;KEY&quot;</span>, 1);</div>
</div><!-- fragment --><p ><b>Rationale</b></p>
<ul>
<li>Better mapping to FITS structure (separate header unit and data unit);</li>
<li>Cleaner <code>SifFile</code> (e.g. no more useless <code>index()</code> method);</li>
<li>Better application of the Single Responsibility Principle (e.g. <code>BintableHdu</code> goes from 57 methods to 15 in <code>BintableColumns</code>);</li>
<li>Better structured documentation, while many more services are provided;</li>
<li>Enable row-wise binary table I/Os.</li>
</ul>
<p ><b>Status in version 3.2</b></p>
<p >Header- and data-level handlers are implemented. Methods in HDU-level handlers still exist for backward compatibility, although they are marked deprecated.</p>
<p ><b>Impact on client code</b></p>
<ul>
<li>Manual fix: 1 to 2 more calls in user code for each HDU;</li>
<li>Negligible impact on runtime.</li>
</ul>
<h2><a class="anchor" id="autotoc_md76"></a>
RecordHdu becomes Hdu</h2>
<p ><b>Rationale</b></p>
<ul>
<li>Given the new handler level, <code>(Record)Hdu</code> is not responsible anymore for record I/Os;</li>
<li>Inheritance is more explicit: <code>ImageHdu</code> and <code>BintableHdu</code> both extend <code>Hdu</code>.</li>
</ul>
<p ><b>Status in version 3.2</b></p>
<p >Name has changed. Deprecated alias <code>RecordHdu</code> is provided for backward-compatibility.</p>
<p ><b>Impact on client code</b></p>
<ul>
<li>Find and replace word <code>RecordHdu</code> with <code>Hdu</code>, including in include directives.</li>
</ul>
<h2><a class="anchor" id="autotoc_md77"></a>
FitsFile::Permission becomes FileMode</h2>
<p ><b>Rationale</b></p>
<ul>
<li>More classical;</li>
<li>Analogous to <code>RecordMode</code>;</li>
<li>Remove useless scoping, shorten usage.</li>
</ul>
<p ><b>Status in version 3.2</b></p>
<p >Name and scope have changed. A deprecated alias <code>FitsFile::Permission</code> is provided for backward compatibility.</p>
<p ><b>Impact on client code</b></p>
<ul>
<li>Find and replace occurrences of <code>FitsFile::Permission</code>, <code>SifFile::Permission</code> and <code>MefFile::Permission</code> with <code>FileMode</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md78"></a>
HduType becomes HduCategory</h2>
<p >And it is now a proper class instead of an enum.</p>
<p ><b>Rationale</b></p>
<ul>
<li>Much richer concept now, e.g. with support for HDU state filtering;</li>
<li>Enable implementation of HDU selectors, along with iterators;</li>
<li>Analogous usage to <code>KeywordCategory</code>.</li>
</ul>
<p ><b>Status in version 3.2</b></p>
<p >Name has changed. A deprecated alias <code>HduType</code> is provided for backward compatibility.</p>
<p ><b>Impact on client code</b></p>
<ul>
<li>Find and replace occurrences of word <code>HduType</code> with <code>HduCategory</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md79"></a>
MefFile::accessPrimary() becomes MefFile::primary() and is not a template anymore</h2>
<p >An <code>ImageHdu</code> is always returned by <code>MefFile::primary()</code>.</p>
<p ><b>Rationale</b></p>
<ul>
<li>The Primary is always an image;</li>
<li>With the 3rd handler layer, there is no more reason to return a <code>RecordHdu</code> (see impact below).</li>
</ul>
<p ><b>Status is version 3.2</b></p>
<p >Both <code>MefFile::accessPrimary&lt;T&gt;()</code> and <code>MefFile::primary()</code> are implemented.</p>
<p ><b>Impact on client code</b></p>
<ul>
<li>Replace <code>MefFile::accessPrimary&lt;Hdu&gt;()</code> and <code>MefFile::accessPrimary&lt;ImageHdu&gt;()</code> with <code>MefFile::access()</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md80"></a>
Raster::shape and Column::info become methods</h2>
<p ><b>Rationale</b></p>
<p >Data classes should ensure data integrity as much as possible. This is not possible with member variables.</p>
<p ><b>Status in version 3.2</b></p>
<p >Not implemented.</p>
<p ><b>Impact on client code</b></p>
<ul>
<li>For reading, replace <code>raster.shape</code> and <code>column.info</code> with <code>raster.shape()</code> and <code>column.info()</code>.</li>
<li>The values cannot be changed after construction (at least for now).</li>
</ul>
<h1><a class="anchor" id="autotoc_md81"></a>
Breaking changes in 3.0</h1>
<h2><a class="anchor" id="autotoc_md82"></a>
All indices are 0-based</h2>
<p >Most indices in 2.0 were 0-based (e.g. in <code>Raster</code> and <code>Column</code>). A notable exception was the HDU index, which used to follow the CFITSIO convention. Yet, the FITS standard doesn't set any convention for HDU indices (well, HDU indices are not even mentioned in the standard). Therefore, it was decided to homogeneize indexing, and follow the C++ convention instead.</p>
<p >For more details, see <a class="el" href="group__types.html">On types</a>.</p>
<h1><a class="anchor" id="autotoc_md83"></a>
Breaking changes in 2.0</h1>
<h2><a class="anchor" id="autotoc_md84"></a>
Method name change</h2>
<ul>
<li>Method name case is now pascalCase, according to Euclid quality rules;</li>
<li>Method names are homogeneized. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<hr class="footer" />
<address class="footer"><small>
    © Copyright 2019-2022 CNES and contributors (for the Euclid Science Ground Segment).
    <br>
    The EleFits documentation is licensed under a
    <a rel="license" href="md_LICENSE.html">LGPL-3.0-or-later</a> license.
    <br>
    It is generated by <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.9.2
    with a theme adapted from <a href="https://github.com/jothepro/doxygen-awesome-css">Doxygen Awesome</a>
    and using <a href="https://github.com/tholman/github-corners">GitHub Corners</a>.
    Thank you all!
  </small></address>
</body>
</html>